app.factory("AuthService",["$http","Session","AlertService",function(e,t,r){return{login:function(r){return e({method:"POST",url:dir_api+"/sesion",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){t.create(e.data.DATA.id,e.data.DATA.nombre,e.data.DATA.perfil)})},logout:function(){return e({method:"GET",url:dir_api+"/sesion/logout",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){t.destroy(),r.add("success",e.data.MSG,1e3)})},isAuthenticated:function(){return!!t.getUserId()},isAuthorized:function(e){angular.isArray(e)||(e=[e]);var r=this.isAuthenticated(),o=-1!=e.indexOf(t.getUserRole());return r&&o}}}]),app.service("Session",["AlertService","$rootScope",function(e){return this.create=function(t,r,o){"undefined"!=typeof Storage?(localStorage.userId=t,localStorage.userName=r,localStorage.userRole=o):e.add("danger","El navegador no soporta sessionStorage",5e3)},this.destroy=function(){localStorage.userId=null,localStorage.userName=null,localStorage.userRole=null},this.getUserName=function(){var e="null"!=localStorage.userName?localStorage.userName:"";return e},this.getUserId=function(){return localStorage.userId},this.getUserRole=function(){return localStorage.userRole},this}]),app.factory("AuthInterceptor",["$rootScope","$q","AUTH_EVENTS",function(e,t,r){return{responseError:function(o){return 401===o.status&&e.$broadcast(r.notAuthenticated,o),403===o.status&&e.$broadcast(r.notAuthorized,o),(419===o.status||440===o.status)&&e.$broadcast(r.sessionTimeout,o),t.reject(o)}}}]);