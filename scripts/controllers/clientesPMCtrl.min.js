app.controller("clientesPMCtrl",["$scope","$modal","$filter","$log","AlertService","clientesPMService","$timeout","$location",function(e,n,t,a,l,o){return e.order="-nombre",e.query="",e.filterSubmitted="",e.page=0,e.data=[],e.parar=!1,e.pending=!1,e.cargarClientes=function(){e.page++,e.pending=!0,o.clientes(e.page,e.filterSubmitted).then(function(n){if(n.data.DATA.length>0)for(i=0;i<n.data.DATA.length;i++)e.data.push(n.data.DATA[i]);else e.data.length>0&&$(".finClientes").html('<div class="fin"></div>'),e.parar=!0;e.pending=!1},function(n){e.pending=!1,e.parar=!0,l.add("danger",n.data.MSG)})},e.cargarClientes(),e.filtrarClientes=function(){e.parar=!1,e.data=[],e.page=0,e.filterSubmitted=e.query,e.cargarClientes()},e.openCliente=function(i){e.selectedCliente=""!=i?t("getById")(e.data,i):e.selectedCliente="",angular.element("#nombre").focus();var a=n.open({templateUrl:dir_root+"/templates/clientesPM/addedit.html",windowClass:"wndClientesPM",controller:"ModalClientesPMInstanceCtrl",backdrop:"static",keyboard:!0,resolve:{clientePM:function(){return e.selectedCliente}}});a.result.then(function(n){""==e.selectedCliente?o.addCliente(n).then(function(n){e.data.push(n.data.DATA),l.add("success","Se agregó un nuevo cliente por mayor.",1e3)},function(e){var n=e.data.MSG;l.add("danger",n,5e3)}):o.editCliente(n).then(function(){l.add("success","Se actualizó la información del cliente por mayor.",1e3)},function(e){l.add("danger",e.data.MSG,3e3)})},function(i){if("delete"==i.action){var a={msj:"¿Está seguro que desea eliminar este cliente?",accept:"Si",cancel:"No"},c=i.idCliente,d=n.open({templateUrl:dir_root+"/templates/confirm.html",windowClass:"wndConfirm",controller:"modalConfirmCtrl",resolve:{txt:function(){return a}}});d.result.then(function(){o.deleteCliente(c).then(function(){var n=t("getIndexById")(e.data,c);e.data.splice(n,1)},function(e){l.add("danger",e.data.MSG,3e3)})},function(){})}})},e.enviarmail=function(i){e.selectedCliente=t("getById")(e.data,i),angular.element("#cuerpo").focus();var a=n.open({templateUrl:dir_root+"/templates/clientesPM/mail.html",windowClass:"wndMail",controller:"ModalMailCtrl",backdrop:"static",keyboard:!0,resolve:{clientePM:function(){return e.selectedCliente}}});a.result.then(function(e){o.enviarMail(e).then(function(e){l.add("success",e.data.MSG,2e3)},function(e){l.add("danger",e.data.MSG)})},function(){})},e.nuevo=function(){e.openCliente("")},$("#infinite-scrolling").size()>0?void $(window).on("scroll",function(){$(window).scrollTop()>$(document).height()-$(window).height()-60&!e.parar&!e.pending&&e.cargarClientes()}):void 0}]),app.controller("ModalClientesPMInstanceCtrl",["$scope","$modalInstance","$filter","clientePM",function(e,n,t,i){if(""!=i){var a=angular.copy(i);e.clientePM=i}else{e.clientePM={nombre:"",local:"",tel:"",tel2:"",direccion:"",localidad:"",email:"",bonificacion:"",nota:""};var a=e.clientePM}e.ok=function(){n.close({clientesPM:e.clientePM})},e.cancel=function(){e.back2original(),n.dismiss({action:"cancel"})},e.deleteCliente=function(){e.back2original();var t={action:"delete",idCliente:e.clientePM.id};n.dismiss(t)},e.back2original=function(){e.clientePM.id=a.id,e.clientePM.nombre=a.nombre,e.clientePM.local=a.local,e.clientePM.tel=a.tel,e.clientePM.tel2=a.tel2,e.clientePM.direccion=a.direccion,e.clientePM.localidad=a.localidad,e.clientePM.email=a.email,e.clientePM.bonificacion=a.bonificacion,e.clientePM.nota=a.nota}}]),app.controller("ModalMailCtrl",["$scope","$modalInstance","AlertService","clientePM",function(e,n,t,i){e.mail={cliente:i},e.mail.saludo="Hola "+e.mail.cliente.nombre+",",e.mail.cuerpo="Desde Los Vados del Isen te enviamos este link para que puedas realizar tu pedido.\n\nTené en cuenta que solo funcionará durante los próximos 7 días.",e.mail.despedida="Esperamos tu pedido. \n \n Los Vados del Isen",e.cancel=function(){n.dismiss()},e.ok=function(){n.close({idCliente:e.mail.cliente.id,saludo:e.mail.saludo,texto:e.mail.cuerpo,despedida:e.mail.despedida})}}]);