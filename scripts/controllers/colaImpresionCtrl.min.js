app.controller("colaImpresionCtrl",["$scope","$modal","$filter","$log","AlertService","colaImpresionService","productosService","$location","$window","$timeout","Session",function(e,o,t,d,a,n,i,s,r,l,u){n.impresiones(u.getUserId()).then(function(o){e.data=o.data.DATA},function(){}),e.mod_options=[],e.modelo={nombre:"",id:"",precio:"",cantidad:""},e.deleteImpresion=function(d){var i={msj:"¿Está seguro que desea eliminar este producto de la cola de impresión?",accept:"Si",cancel:"No"},c=o.open({templateUrl:dir_root+"/templates/confirm.html",windowClass:"wndConfirm",controller:"modalConfirmCtrl",resolve:{txt:function(){return i}}});c.result.then(function(){n.deleteImpresion(d).then(function(){var o=t("getIndexById")(e.data,d);e.data.splice(o,1)},function(e){a.add("danger",e.data.MSG)})},function(){})},e.searchByName=function(){""!=e.form.modelo.nombre&&i.getProductoModeloByName(e.form.modelo.nombre).then(function(o){e.mod_options=o.data.DATA},function(o){(403==o.status||401==o.status)&&($modalInstance.dismiss({action:"cancel"}),s.path("/index")),e.mod_options=[]})},e.setModel=function(o){e.modelo=o},e.add=function(){""!=e.modelo.nombre&&n.addModeloImpresion({modelos_id:e.modelo.id,belongsTo:u.getUserId()}).then(function(o){e.data.sueltos.modelos.push({nombre:e.modelo.nombre,modelos_id:e.modelo.id,precio:e.modelo.precio,id:o.data.DATA.id}),angular.element("#newMod").val(""),angular.element("#newMod").focus()},function(e){a.add("danger",e.data.MSG)})},e.removeProducto=function(o,t,d){n.deleteModeloImpresion(o).then(function(){switch(d){case"reposicion":e.data.reposicion.modelos.splice(t,1);case"sueltos":e.data.sueltos.modelos.splice(t,1)}},function(e){a.add("danger",e.data.MSG)})},e.removeFromPedidos=function(o,t,d){n.deleteModeloImpresion(o).then(function(){1==e.data.pedidos[t].productos.length?e.data.pedidos.splice(t,1):e.data.pedidos[t].productos.splice(d,1)},function(e){a.add("danger",e.data.MSG)})},e.removeFromProducciones=function(o,t,d){n.deleteModeloImpresion(o).then(function(){1==e.data.producciones[t].productos.length?e.data.producciones.splice(t,1):e.data.producciones[t].productos.splice(d,1)},function(e){a.add("danger",e.data.MSG)})},e.vaciarCola=function(t,d){var i;switch(t){case"reposicion":i={msj:"Se eliminarán todos los productos de la cola de impresión de resposición. ¿Desea continuar?",accept:"Si",cancel:"No"};break;case"sueltos":i={msj:"Se eliminarán todos los productos de su cola de impresión. ¿Desea continuar?",accept:"Si",cancel:"No"};break;case"producciones":i={msj:"Se eliminará la cola de impresión de la producción de "+e.data.producciones[d].responsable+". ¿Desea continuar?",accept:"Si",cancel:"No"};break;case"ventas":i={msj:"Se eliminará la cola de impresión de las devoluciones en ventas. ¿Desea continuar?",accept:"Si",cancel:"No"};break;default:i={msj:"Se eliminará la cola de impresión del pedido de "+e.data.pedidos[d].clientePM+". ¿Desea continuar?",accept:"Si",cancel:"No"}}var c=o.open({templateUrl:dir_root+"/templates/confirm.html",windowClass:"wndConfirm",controller:"modalConfirmCtrl",resolve:{txt:function(){return i}}});c.result.then(function(){switch(t){case"reposicion":e.data.reposicion.modelos.forEach(function(e){n.deleteModeloImpresion(e.id).then(function(){},function(e){a.add("danger",e.data.MSG)})}),e.data.reposicion.modelos=[];break;case"sueltos":e.data.sueltos.modelos.forEach(function(e){n.deleteModeloImpresion(e.id).then(function(){},function(e){a.add("danger",e.data.MSG)})}),e.data.sueltos.modelos=[];break;case"ventas":e.data.ventas.modelos.forEach(function(e){n.deleteModeloImpresion(e.id).then(function(){},function(e){a.add("danger",e.data.MSG)})}),e.data.ventas.modelos=[];break;case"producciones":var o=!1,i=e.data.producciones[d].modelos;i.every(function(){return n.deleteModeloImpresionProduccion(e.data.producciones[d].producciones_id).then(function(){},function(e){a.add("danger",e.data.MSG),o=!0}),o===!1}),e.data.producciones.splice(d,1);break;default:var o=!1,i=e.data.pedidos[d].productos;i.every(function(){return n.deleteModeloImpresionPedido(e.data.pedidos[d].pedidos_id).then(function(){},function(e){a.add("danger",e.data.MSG),o=!0}),o===!1}),e.data.pedidos.splice(d,1)}},function(){})},e.imprimir=function(o,t){"reposicion"==o||"sueltos"==o||"ventas"==o?(productosAImprimir="reposicion"==o?e.data.reposicion.modelos:"sueltos"==o?e.data.sueltos.modelos:e.data.ventas.modelos,e.imprimirEtiquetasBarcode(productosAImprimir)):"producciones"==o?(productosAImprimir=e.data.producciones[t].modelos,e.imprimirEtiquetasBarcode(productosAImprimir)):e.imprimirPedido(t)},e.imprimirEtiquetasBarcode=function(e){var o,t=0;$("#codes").empty(),e.length>0&&(style={barWidth:1,barHeight:21,fontSize:8},e.forEach(function(e){for(var d=e.modelos_id,a=d.length,n=7-a,i=0;n>i;i++)d="0"+d;bcdiv=document.createElement("div"),bcdiv.setAttribute("id","bcTarget"+t),bcdiv.setAttribute("class","etiqueta"),$("#codes").append(bcdiv),o=document.createElement("div"),o.setAttribute("id","bc"+t),o.setAttribute("class","bc"),p=document.createElement("p"),p.setAttribute("id","prod"+t),p.setAttribute("class","nombre"),e.nombre.length>52&&p.setAttribute("class","nombreChico"),pr=document.createElement("p"),pr.setAttribute("class","precio"),pr.setAttribute("id","prec"+t),$("#bcTarget"+t).append(o),$("#bcTarget"+t).append(p),$("#bcTarget"+t).append(pr),$("#prec"+t).text("$"+e.precio),$("#bc"+t).barcode({code:d,crc:!1},"int25",style),$("#prod"+t++).text(e.nombre),salto=document.createElement("div"),salto.setAttribute("class","saltopagina"),$("#codes").append(salto)}),$("#codes :last-child").last().remove(),r.print())},e.imprimirPedido=function(o){if($("#codes").empty(),e.data.pedidos[o].productos.length>0){var t=0;e.data.pedidos[o].productos.forEach(function(e){bcdiv=document.createElement("div"),bcdiv.setAttribute("id","bcTarget"+t),bcdiv.setAttribute("class","etiqueta"),$("#codes").append(bcdiv),p=document.createElement("p"),p.setAttribute("class","nombrePedido"),p.setAttribute("id","prod"+t),c=document.createElement("p"),c.setAttribute("class","cantidadPedido"),c.setAttribute("id","cant"+t),$("#bcTarget"+t).append(p),$("#bcTarget"+t).append(c),$("#prod"+t).text(e.nombre),$("#cant"+t++).text(" x "+e.cantidad),salto=document.createElement("div"),salto.setAttribute("class","saltopagina"),$("#codes").append(salto)}),$("#codes :last-child").last().remove(),r.print()}}}]);