app.controller("usuariosCtrl",["$scope","$modal","$filter","$log","AlertService","usuariosService","$timeout",function(e,a,o,i,s,r){e.order="-nombre",e.nomPerfiles=["","Admin","Taller","Local","Cuentas"],listusuarios=function(a){e.data=a},r.usuarios(listusuarios),e.openUsuario=function(i){e.selectedUsuario=""!=i?o("getById")(e.data,i):"",angular.element("#nombre").focus();var t=a.open({templateUrl:dir_root+"/templates/usuarios/addedit.html",windowClass:"wndUsuarios",controller:"ModalUsuariosInstanceCtrl",backdrop:"static",keyboard:!0,resolve:{usuarios:function(){return e.selectedUsuario}}});t.result.then(function(a){""==e.selectedUsuario?r.addUsuario(a).then(function(a){e.data.push(a.data.DATA),s.add("success","El usuario fue creado",1e3)},function(e){var a=e.data.MSG;s.add("danger",a,5e3)}):r.editUsuario(a).then(function(){s.add("success","El usuario fue actualizado",1e3)},function(e){s.add("danger",e.data.MSG)})},function(i){if("delete"==i.action){var t={msj:"¿Está seguro que desea eliminar este usuario?",accept:"Si",cancel:"No"},n=i.idUsuario,u=a.open({templateUrl:dir_root+"/templates/confirm.html",windowClass:"wndConfirm",controller:modalConfirmCtrl,resolve:{txt:function(){return t}}});u.result.then(function(){r.deleteUsuario(n).then(function(){var a=o("getIndexById")(e.data,n);e.data.splice(a,1)},function(e){s.add("danger",e.data.MSG)})},function(){})}})},e.nuevo=function(){e.openUsuario("")}}]),app.controller("ModalUsuariosInstanceCtrl",["$scope","$modalInstance","$filter","usuarios",function(e,a,o,i){if(""!=i){var s=angular.copy(i);e.usuarios=i}else{e.usuarios={nombre:"",clave:"",perfiles_id:"",perfil:""};var s=e.usuarios}e.perfiles=[{value:"1",text:"Admin"},{value:"3",text:"Local"},{value:"2",text:"Taller"},{value:"4",text:"Cuentas"}],e.ok=function(){a.close({usuarios:e.usuarios})},e.cancel=function(){e.back2original(),a.dismiss({action:"cancel"})},e.deleteUsuario=function(){e.back2original();var o={action:"delete",idUsuario:e.usuarios.id};a.dismiss(o)},e.back2original=function(){e.usuarios.nombre=s.nombre,e.usuarios.clave=s.clave,e.usuarios.perfiles_id=s.perfiles_id}}]);