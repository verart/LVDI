app.controller("productosCtrl",["$scope","$modal","$filter","productosService","$log","AlertService",function(o,t,d,a,e,n){o.order="-nombre",o.filterProds={enProduccion:1},o.infoModal={},o.alerts=[],$(window).unbind("scroll"),a.productos().then(function(t){o.data=t.data.DATA},function(){}),o.exceptEmptyComparator=function(o,t){return t?angular.equals(t,o):!0},o.reponer=function(t,e){var n=d("getById")(o.data,t);a.reponerProducto(n.modelos[e].id),n.modelos[e].stock++},o.openProducto=function(e,r){o.infoModal.producto=""!=e?d("getById")(o.data,e):"",o.infoModal.userRole=r,angular.element("#nombre").focus();var c=t.open({templateUrl:dir_root+"/templates/productos/addedit.html",windowClass:"wndProducto",controller:"ModalInstanceCtrl",backdrop:"static",keyboard:!0,resolve:{info:function(){return o.infoModal}}});c.result.then(function(t){""==e?a.addProducto(t).then(function(t){o.data.push(t.data.DATA)},function(o){var t=o.data.MSG;n.add("danger",t,5e3)}):a.editProducto(t).then(function(t){var a=d("getIndexById")(o.data,t.data.DATA.id);o.data[a]=t.data.DATA,n.add("success","Se guardaron las modificaciones",1e3)},function(o){n.add("danger",o.data.MSG,2e3)})},function(e){if("delete"==e.action){var r={msj:"¿Está seguro que desea eliminar este producto?",accept:"Si",cancel:"No"},c=e.idProd,l=t.open({templateUrl:dir_root+"/templates/confirm.html",windowClass:"wndConfirm",controller:modalConfirmCtrl,resolve:{txt:function(){return r}}});l.result.then(function(){a.deleteProducto(c).then(function(){var t=d("getIndexById")(o.data,c);o.data.splice(t,1)},function(o){n.add("danger",o.data.MSG)})},function(){})}})},o.nuevo=function(t){o.openProducto("",t)},o.search=function(t){if(void 0===o.queryId||0===o.queryId.length)return!0;var d=!1;return angular.forEach(t.modelos,function(t){t.id==parseInt(o.queryId)&&(d=!0)}),d}}]),app.controller("ModalInstanceCtrl",["$scope","$modalInstance","$filter","info","$modal",function(o,t,d,a,e){if(""!=a.producto){var n=angular.copy(a.producto);o.producto=a.producto}else{o.producto={nombre:"",precio:"",img:"img/productos/noimg.jpg",modelos:[],enProduccion:"1"};var n=o.producto}o.producto.mod2delete=[],o.producto.mod2baja=[],o.producto.mod2alta=[],o.userRole=a.userRole,o.ok=function(){t.close(o.producto)},o.cancel=function(){o.back2original(),t.dismiss({action:"cancel"})},o.deleteProducto=function(){o.back2original();var d={action:"delete",idProd:o.producto.id};t.dismiss(d)},o.back2original=function(){o.producto.nombre=n.nombre,o.producto.precio=n.precio,o.producto.stock=n.stock,o.producto.enProduccion=n.enProduccion,o.producto.modelos=n.modelos,o.producto.img=n.img,o.producto.mod2delete=[],o.producto.mod2baja=[],o.producto.mod2alta=[]},o.remove=function(t){var d={msj:"¿Está seguro que desea eliminar este color del producto?",accept:"Si",cancel:"No"},a=e.open({templateUrl:dir_root+"/templates/confirm.html",windowClass:"wndConfirm",controller:modalConfirmCtrl,resolve:{txt:function(){return d}}});a.result.then(function(){idMod=o.producto.modelos[t].id,o.producto.modelos.splice(t,1),null!=idMod&&o.producto.mod2delete.push({id:idMod})},function(){})},o.add=function(t){o.producto.modelos.push({nombre:t||"",fechaVenta:"",fechaRep:"",stock:0}),angular.element("#newMod").val(""),angular.element("#newMod").focus()},o.baja=function(t){var a=o.producto.modelos[t].id,n=d("getIndexById")(o.producto.mod2baja,a);if(null!=n)o.producto.mod2baja[n].cantBaja=o.producto.mod2baja[n].cantBaja+1,o.producto.modelos[t].stock--;else{var r=d("getIndexById")(o.producto.mod2alta,a);if(null!=r)o.producto.mod2alta[r].cantAlta=o.producto.mod2alta[r].cantAlta-1,o.producto.modelos[t].stock--,0==o.producto.mod2alta[r].cantAlta&&o.producto.mod2alta.splice(r,1);else{var c=e.open({templateUrl:dir_root+"/templates/productos/confirmarBaja.html",windowClass:"wndBajaProducto",controller:ModalBajaCtrl,backdrop:"static",keyboard:!0});c.result.then(function(d){o.producto.modelos[t].stock--,o.producto.mod2baja.push({id:a,cantBaja:1,nota:d})},function(){})}}},o.alta=function(t){o.producto.modelos[t].stock++;var a=o.producto.modelos[t].id,e=d("getIndexById")(o.producto.mod2alta,a);if(null!=e)o.producto.mod2alta[e].cantAlta=o.producto.mod2alta[e].cantAlta+1;else{var n=d("getIndexById")(o.producto.mod2baja,a);null!=n?(o.producto.mod2baja[n].cantBaja=o.producto.mod2baja[n].cantBaja-1,0==o.producto.mod2baja[n].cantBaja&&o.producto.mod2baja.splice(n,1)):o.producto.mod2alta.push({id:a,cantAlta:1})}}}]),app.controller("ModalBajaCtrl",["$scope","$modalInstance",function(o,t){o.nota={texto:""},o.ok=function(){t.close(o.nota.texto)},o.cancel=function(){t.dismiss()}}]);