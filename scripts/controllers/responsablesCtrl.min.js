app.controller("responsablesCtrl",["$scope","$modal","$filter","$log","AlertService","responsablesService","$timeout",function(e,a,n,o,s,t){return e.order="-nombre",e.query="",e.filterSubmitted="",e.page=0,e.data=[],e.parar=!1,e.pending=!1,e.cargarResponsables=function(){e.page++,e.pending=!0,t.responsables(e.page,e.filterSubmitted).then(function(a){if(a.data.DATA.length>0)for(i=0;i<a.data.DATA.length;i++)e.data.push(a.data.DATA[i]);else e.data.length>0&&$(".finResponsables").html('<div class="fin"></div>'),e.parar=!0;e.pending=!1},function(a){e.pending=!1,s.add("danger",a.data.MSG),$location.path("/login")})},e.cargarResponsables(),e.filtrarResponsables=function(){e.parar=!1,e.data=[],e.page=0,e.filterSubmitted=e.query,e.cargarResponsables()},e.openRes=function(o){e.selectedRes=""!=o?n("getById")(e.data,o):"",angular.element("#nombre").focus();var l=a.open({templateUrl:dir_root+"/templates/responsables/addedit.html",windowClass:"wndClientesPM",controller:"ModalResponsablesInstanceCtrl",backdrop:"static",keyboard:!0,resolve:{responsable:function(){return e.selectedRes}}});l.result.then(function(a){""==e.selectedRes?t.addRes(a).then(function(a){console.log(a.data.DATA),lastName=e.data[e.data.length-1].nombre.toUpperCase(),newName=a.data.DATA.nombre.toUpperCase(),lastName>newName&&e.data.push(a.data.DATA),s.add("success",a.data.MSG,5e3)},function(e){var a=e.data.MSG;s.add("danger",a,5e3)}):t.editRes(a).then(function(){s.add("success","Se actualizó la información del responsable de producción.",1500)},function(e){s.add("danger",e.data.MSG)})},function(o){if("delete"==o.action){var l={msj:"¿Está seguro que desea eliminar este responsables de producción?",accept:"Si",cancel:"No"},r=o.idR,i=a.open({templateUrl:dir_root+"/templates/confirm.html",windowClass:"wndConfirm",controller:modalConfirmCtrl,resolve:{txt:function(){return l}}});i.result.then(function(){t.deleteRes(r).then(function(){var a=n("getIndexById")(e.data,r);e.data.splice(a,1)},function(e){s.add("danger",e.data.MSG)})},function(){})}})},e.nuevo=function(){e.openRes("")},$("#infinite-scrolling").size()>0?void $(window).on("scroll",function(){$(window).scrollTop()>$(document).height()-$(window).height()-60&!e.parar&!e.pending&&e.cargarResponsables()}):void 0}]),app.controller("ModalResponsablesInstanceCtrl",["$scope","$modalInstance","$filter","responsable",function(e,a,n,o){if(""!=o){var s=angular.copy(o);e.responsable=o}else{e.responsable={nombre:"",tel:"",tel2:"",direccion:"",localidad:"",email:"",marca:"",nota:""};var s=e.responsable}e.ok=function(){a.close({responsables:e.responsable})},e.cancel=function(){e.back2original(),a.dismiss({action:"cancel"})},e.deleteRes=function(){console.log(e.responsable),e.back2original();var n={action:"delete",idR:e.responsable.id};a.dismiss(n)},e.back2original=function(){e.responsable.id=s.id,e.responsable.nombre=s.nombre,e.responsable.marca=s.local,e.responsable.tel=s.tel,e.responsable.tel2=s.tel2,e.responsable.direccion=s.direccion,e.responsable.localidad=s.localidad,e.responsable.email=s.email,e.responsable.nota=s.nota}}]);