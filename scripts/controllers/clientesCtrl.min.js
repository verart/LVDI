app.controller("clientesCtrl",["$scope","$modal","$filter","$log","AlertService","clientesService","$timeout",function(e,n,t,a,l,o){return e.order="-nombre",e.query="",e.filterSubmitted="",e.page=0,e.data=[],e.parar=!1,e.pending=!1,e.cargarClientes=function(){e.page++,e.pending=!0,o.clientes(e.page,e.filterSubmitted).then(function(n){if(n.data.DATA.length>0)for(i=0;i<n.data.DATA.length;i++)e.data.push(n.data.DATA[i]);else e.data.length>0&&$(".finClientes").html('<div class="fin"></div>'),e.parar=!0;e.pending=!1},function(n){e.pending=!1,l.add("danger",n.data.MSG,3e3),$location.path("/login")})},e.cargarClientes(),e.filtrarClientes=function(){e.parar=!1,e.data=[],e.page=0,e.filterSubmitted=e.query,e.cargarClientes()},e.openCliente=function(a){e.selectedCliente=""!=a?t("getById")(e.data,a):"",angular.element("#nombre").focus();var i=n.open({templateUrl:dir_root+"/templates/clientes/addedit.html",windowClass:"wndClientes",controller:"ModalClientesInstanceCtrl",backdrop:"static",keyboard:!0,resolve:{clientes:function(){return e.selectedCliente}}}),r=t("orderBy");i.result.then(function(n){""==e.selectedCliente?o.addCliente(n).then(function(n){lastName=e.data[e.data.length-1].nombre.toUpperCase(),newName=n.data.DATA.nombre.toUpperCase(),lastName>newName&&e.data.push(n.data.DATA),l.add("success",n.data.MSG,2e3),r(e.data,"-nombre",!1)},function(e){var n=e.data.MSG;l.add("danger",n,3e3)}):o.editCliente(n).then(function(){l.add("success","Se actualizó la información del cliente.",1e3)},function(e){l.add("danger",e.data.MSG,3e3)})},function(a){if("delete"==a.action){var i={msj:"¿Está seguro que desea eliminar este cliente?",accept:"Si",cancel:"No"},r=a.idCliente,d=n.open({templateUrl:dir_root+"/templates/confirm.html",windowClass:"wndConfirm",controller:"modalConfirmCtrl",resolve:{txt:function(){return i}}});d.result.then(function(){o.deleteCliente(r).then(function(){var n=t("getIndexById")(e.data,r);e.data.splice(n,1)},function(e){l.add("danger",e.data.MSG,3e3)})},function(){})}})},e.nuevo=function(){e.openCliente("")},e.exportarMails=function(){mails=[],o.getMails().then(function(e){n.open({templateUrl:dir_root+"/templates/printDoc.html",windowClass:"wndPdf",controller:"modalPdfClientesMailsCtrl",resolve:{clientes:function(){return e.data.DATA}}})},function(e){l.add("danger",e.data.MSG,3e3)})},$("#infinite-scrolling").size()>0?void $(window).on("scroll",function(){$(window).scrollTop()>$(document).height()-$(window).height()-60&!e.parar&!e.pending&&e.cargarClientes()}):void 0}]),app.controller("ModalClientesInstanceCtrl",["$scope","$modalInstance","$filter","clientes",function(e,n,t,a){if(""!=a){var i=angular.copy(a);e.clientes=a}else{e.clientes={nombre:"",email:"",nota:""};var i=e.clientes}e.ok=function(){n.close({clientes:e.clientes})},e.cancel=function(){e.back2original(),n.dismiss({action:"cancel"})},e.deleteCliente=function(){e.back2original();var t={action:"delete",idCliente:e.clientes.id};n.dismiss(t)},e.back2original=function(){e.clientes.nombre=i.nombre,e.clientes.email=i.email,e.clientes.nota=i.nota}}]);